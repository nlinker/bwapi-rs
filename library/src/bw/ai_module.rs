use crate::bw::player::Player;
use crate::bw::position::Position;
use crate::bw::unit::Unit;
use thin_trait_object::*;

#[thin_trait_object]
pub trait AIModule {
    fn on_event(&mut self, event: Event);
}

pub enum Event {
    OnStart(),
    OnEnd(bool),
    OnFrame(),
    OnSendText(String),
    OnReceiveText(Player, String),
    OnPlayerLeft(Player),
    OnNukeDetect(Position),
    OnUnitDiscover(Unit),
    OnUnitEvade(Unit),
    OnUnitShow(Unit),
    OnUnitHide(Unit),
    OnUnitCreate(Unit),
    OnUnitDestroy(Unit),
    OnUnitMorph(Unit),
    OnUnitRenegade(Unit),
    OnSaveGame(String),
    OnUnitComplete(Unit),
}

/// `BoxedAIModule` is the synthetic type generated by `thin_trait_object` macro.
/// IDE however, doesn't know about this type and complains a lot, so we
/// use this artificial definitions to keep IDE's mouth shut.
#[cfg(ignore_this)]
pub struct BoxedAIModule<'a>(Box<dyn AIModule>);

#[cfg(ignore_this)]
impl<'a> BoxedAIModule<'a> {
    pub fn new<'a, T: AIModule>(t: T) -> Self {
        Self(t)
    }
}

// https://github.com/kotauskas/thin_trait_object/issues/2
unsafe impl Send for BoxedAIModule<'_> {}
unsafe impl Sync for BoxedAIModule<'_> {}